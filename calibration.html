<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisionKrono - Calibra√ß√£o</title>
    <link rel="stylesheet" href="calibration.css">
</head>
<body>
    <div class="calibration-app">
        <header class="header">
            <div class="header-nav">
                <button id="backBtn" class="btn secondary" style="display: none;">‚Üê Voltar aos Eventos</button>
                <button id="homeBtn" class="btn secondary">üè† In√≠cio</button>
            </div>
            <h1>üîß VisionKrono - Calibra√ß√£o</h1>
            <p id="headerSubtitle">Configure os par√¢metros de detec√ß√£o para usar no telem√≥vel</p>
        </header>
        
        <main class="main-content">
            <div class="step-container">
                <!-- Passo 1: Upload da imagem -->
                <div class="step" id="step1">
                    <div class="step-header">
                        <span class="step-number">1</span>
                        <h2>Carregar Imagem de Refer√™ncia</h2>
                    </div>
                    
                    <div class="step-content">
                        <p>Fa√ßa upload de uma foto clara de um dorsal para calibra√ß√£o:</p>
                        
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">üì∏</div>
                            <p>Clique aqui ou arraste uma imagem</p>
                            <small>Formatos aceitos: JPG, PNG</small>
                        </div>
                        
                        <input type="file" id="imageInput" accept="image/*" style="display: none;">
                        
                        <div class="number-input" id="numberInput" style="display: none;">
                            <label for="dorsalNumber">Qual n√∫mero est√° nesta imagem?</label>
                            <input type="number" id="dorsalNumber" min="1" max="9999" placeholder="Ex: 407">
                            <button id="processBtn" class="btn primary">Processar Imagem</button>
                        </div>
                    </div>
                </div>
                
                <!-- Passo 2: Definir padr√£o dos dorsais -->
                <div class="step" id="step2" style="display: none;">
                    <div class="step-header">
                        <span class="step-number">2</span>
                        <h2>Definir Padr√£o dos Dorsais</h2>
                    </div>
                    
                    <div class="step-content">
                        <p>Configure o padr√£o dos dorsais para este evento:</p>
                        
                        <div class="pattern-config">
                            <h3>Tipo de Padr√£o</h3>
                            
                            <div class="pattern-options">
                                <label class="pattern-option">
                                    <input type="radio" name="patternType" value="numeric" checked>
                                    <span>üî¢ Apenas N√∫meros (ex: 001, 123, 400)</span>
                                </label>
                                
                                <label class="pattern-option">
                                    <input type="radio" name="patternType" value="prefix">
                                    <span>üî§ Prefixo + N√∫mero (ex: A001, B123)</span>
                                </label>
                                
                                <label class="pattern-option">
                                    <input type="radio" name="patternType" value="markers">
                                    <span>üé® Marcadores Visuais (ex: -verde 407 -vermelho)</span>
                                </label>
                                
                                <label class="pattern-option">
                                    <input type="radio" name="patternType" value="custom">
                                    <span>‚öôÔ∏è Padr√£o Personalizado</span>
                                </label>
                            </div>
                            
                            <!-- Configura√ß√£o para n√∫meros -->
                            <div id="numericConfig" class="pattern-config-section">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>N√∫mero Inicial</label>
                                        <input type="number" id="numericMin" value="1" min="1" max="9999">
                                    </div>
                                    <div class="form-group">
                                        <label>N√∫mero Final</label>
                                        <input type="number" id="numericMax" value="999" min="1" max="9999">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="numericPadding"> 
                                        Usar zeros √† esquerda (ex: 001, 023)
                                    </label>
                                    <input type="number" id="numericDigits" value="3" min="1" max="6" placeholder="D√≠gitos">
                                </div>
                            </div>
                            
                            <!-- Configura√ß√£o para prefixo -->
                            <div id="prefixConfig" class="pattern-config-section" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Prefixo</label>
                                        <input type="text" id="prefixText" value="A" maxlength="5" placeholder="A, B, CAT">
                                    </div>
                                    <div class="form-group">
                                        <label>N√∫mero Final</label>
                                        <input type="number" id="prefixMax" value="999" min="1" max="9999">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Configura√ß√£o para marcadores visuais -->
                            <div id="markersConfig" class="pattern-config-section" style="display: none;">
                                <div class="form-group">
                                    <h4>üü¢ Marcador de In√≠cio</h4>
                                    <div class="marker-config">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>S√≠mbolo</label>
                                                <input type="text" id="startSymbol" value="-" maxlength="3" placeholder="-, |, ‚óè">
                                            </div>
                                            <div class="form-group">
                                                <label>Cor</label>
                                                <div class="color-picker">
                                                    <input type="color" id="startColor" value="#00ff00">
                                                    <span id="startColorName">Verde</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <h4>üî¥ Marcador de Fim</h4>
                                    <div class="marker-config">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label>S√≠mbolo</label>
                                                <input type="text" id="endSymbol" value="-" maxlength="3" placeholder="-, |, ‚óè">
                                            </div>
                                            <div class="form-group">
                                                <label>Cor</label>
                                                <div class="color-picker">
                                                    <input type="color" id="endColor" value="#ff0000">
                                                    <span id="endColorName">Vermelho</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Toler√¢ncia de Cor (%)</label>
                                    <input type="range" id="colorTolerance" min="5" max="50" value="20">
                                    <span id="colorToleranceValue">20%</span>
                                    <small>Qu√£o pr√≥xima a cor deve estar para ser considerada v√°lida</small>
                                </div>
                                
                                <div class="markers-example">
                                    <h4>Exemplo Visual:</h4>
                                    <div class="example-dorsal">
                                        <span style="color: #00ff00;">-</span>
                                        <span style="color: white; margin: 0 10px;">407</span>
                                        <span style="color: #ff0000;">-</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Configura√ß√£o personalizada -->
                            <div id="customConfig" class="pattern-config-section" style="display: none;">
                                <div class="form-group">
                                    <label>Express√£o Regular</label>
                                    <input type="text" id="customRegex" placeholder="^[A-Z]\d{3}$" value="^\d{1,4}$">
                                    <small>Exemplo: ^A\d{3}$ para A001-A999</small>
                                </div>
                                <div class="form-group">
                                    <label>Exemplos V√°lidos (separados por v√≠rgula)</label>
                                    <input type="text" id="customExamples" placeholder="A001, A123, A999">
                                </div>
                            </div>
                            
                            <div class="pattern-preview">
                                <h4>Pr√©-visualiza√ß√£o:</h4>
                                <div id="patternPreview">001, 002, 003, ..., 999</div>
                            </div>
                        </div>
                        
                        <div class="step-controls">
                            <button id="confirmPatternBtn" class="btn primary">Confirmar Padr√£o</button>
                        </div>
                    </div>
                </div>
                
                <!-- Passo 3: Calibrar par√¢metros -->
                <div class="step" id="step3" style="display: none;">
                    <div class="step-header">
                        <span class="step-number">3</span>
                        <h2>Calibrar Par√¢metros de Detec√ß√£o</h2>
                    </div>
                    
                    <div class="step-content">
                        <p>O sistema vai testar diferentes par√¢metros para detectar o n√∫mero <strong id="targetNumber">--</strong> na sua imagem:</p>
                        
                        <div class="calibration-progress">
                            <h3>Progresso da Calibra√ß√£o</h3>
                            <div id="calibrationProgress">Aguardando in√≠cio...</div>
                        </div>
                        
                        <div class="calibration-results">
                            <h3>Resultados dos Testes</h3>
                            <div id="calibrationResults">Nenhum teste executado ainda</div>
                        </div>
                        
                        <div class="step-controls">
                            <button id="startCalibrationBtn" class="btn primary">Iniciar Calibra√ß√£o</button>
                            <button id="skipCalibrationBtn" class="btn secondary">Usar Padr√µes</button>
                        </div>
                    </div>
                </div>
                
                <!-- Passo 4: Definir √°rea do n√∫mero -->
                <div class="step" id="step4" style="display: none;">
                    <div class="step-header">
                        <span class="step-number">4</span>
                        <h2>Definir √Årea do N√∫mero</h2>
                    </div>
                    
                    <div class="step-content">
                        <p>Clique e arraste para desenhar um ret√¢ngulo <strong>apenas na √°rea do n√∫mero</strong>:</p>
                        
                        <div class="image-workspace">
                            <div class="image-container">
                                <img id="referenceImage" src="" alt="Imagem de refer√™ncia">
                                <canvas id="drawingCanvas"></canvas>
                            </div>
                            
                            <div class="area-info">
                                <h3>√Årea Definida</h3>
                                <div id="areaInfo">Desenhe a √°rea do n√∫mero</div>
                            </div>
                        </div>
                        
                        <div class="step-controls">
                            <button id="resetAreaBtn" class="btn secondary">Limpar √Årea</button>
                            <button id="confirmAreaBtn" class="btn primary" disabled>Confirmar √Årea</button>
                        </div>
                    </div>
                </div>
                
                <!-- Passo 5: Teste e finaliza√ß√£o -->
                <div class="step" id="step5" style="display: none;">
                    <div class="step-header">
                        <span class="step-number">5</span>
                        <h2>Teste e Configura√ß√£o Final</h2>
                    </div>
                    
                    <div class="step-content">
                        <div class="test-results">
                            <h3>Resultado da Calibra√ß√£o</h3>
                            <div id="calibrationResults">Processando...</div>
                        </div>
                        
                        <div class="qr-section">
                            <h3>Acesso Mobile</h3>
                            <div class="qr-container">
                                <div id="qrcode"></div>
                                <p>Escaneie este QR Code no telem√≥vel para acessar a p√°gina de detec√ß√£o</p>
                            </div>
                            
                            <div class="mobile-links">
                                <h4>Links Diretos:</h4>
                                <div id="mobileLinks">Gerando links...</div>
                            </div>
                        </div>
                        
                        <div class="dashboard-section">
                            <h3>Dashboard em Tempo Real</h3>
                            <div class="dashboard-container">
                                <div class="stats-grid">
                                    <div class="stat-card">
                                        <div class="stat-number" id="totalDetections">0</div>
                                        <div class="stat-label">Total Detectado</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-number" id="activeDevices">0</div>
                                        <div class="stat-label">Dispositivos Ativos</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-number" id="lastDetectionTime">--:--</div>
                                        <div class="stat-label">√öltima Detec√ß√£o</div>
                                    </div>
                                </div>
                                
                                <div class="detections-dashboard">
                                    <h4>Detec√ß√µes Recentes</h4>
                                    <div class="detections-table" id="detectionsTable">
                                        <div class="no-data">Aguardando detec√ß√µes...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="final-controls">
                            <button id="testCalibrationBtn" class="btn test">Testar Calibra√ß√£o</button>
                            <button id="resetAllBtn" class="btn secondary">Recome√ßar</button>
                            <button id="openDetectionBtn" class="btn primary">Abrir P√°gina de Detec√ß√£o</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script src="supabase.js"></script>
    <script src="calibration.js"></script>
</body>
</html>
