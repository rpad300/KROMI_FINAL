<!-- ============================================ -->
<!-- SISTEMA DE AUTENTICA√á√ÉO UNIVERSAL v2025102605 -->
<!-- Adicionar este snippet em TODAS as p√°ginas protegidas -->
<!-- ============================================ -->

<!-- Scripts de Autentica√ß√£o -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="supabase.js?v=2025102605"></script>
<script src="auth-system.js?v=2025102605"></script>
<script src="universal-route-protection.js?v=2025102605"></script>

<!-- Tela de Carregamento de Autentica√ß√£o -->
<div id="authLoading" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #1a1a1a; display: flex; align-items: center; justify-content: center; z-index: 9999;">
    <div style="text-align: center; color: #fff;">
        <div style="border: 3px solid #f3f3f3; border-top: 3px solid #fc6b03; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
        <p>Verificando autentica√ß√£o...</p>
    </div>
</div>

<style>
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    #mainContent {
        display: none;
    }
    
    #mainContent.authenticated {
        display: block;
    }
</style>

<script>
    // C√≥digo de autentica√ß√£o universal
    document.addEventListener('DOMContentLoaded', async function() {
        console.log('üîê Iniciando verifica√ß√£o de autentica√ß√£o...');
        
        try {
            // Aguardar sistema de autentica√ß√£o
            await waitForAuthSystem();
            
            console.log('‚úÖ AuthSystem pronto');
            console.log('üë§ Utilizador:', window.authSystem.currentUser?.email);
            console.log('üîë Perfil:', window.authSystem.userProfile?.profile_type);
            
            // Verificar se tem permiss√£o (Admin ou Gestor de Eventos)
            if (!window.authSystem.isAdmin() && !window.authSystem.isEventManager()) {
                console.warn('‚ö†Ô∏è Utilizador sem permiss√£o - redirecionando para login');
                window.location.href = './login.html';
                return;
            }
            
            console.log('‚úÖ Utilizador autenticado e autorizado');
            
            // Mostrar conte√∫do principal
            const authLoading = document.getElementById('authLoading');
            const mainContent = document.getElementById('mainContent');
            
            if (authLoading) authLoading.style.display = 'none';
            if (mainContent) {
                mainContent.style.display = 'block';
                mainContent.classList.add('authenticated');
            }
            
            console.log('‚úÖ P√°gina carregada com sucesso');
            
        } catch (error) {
            console.error('‚ùå Erro na autentica√ß√£o:', error);
            window.location.href = './login.html';
        }
    });
    
    async function waitForAuthSystem() {
        const maxWaitTime = 10000; // 10 segundos
        const startTime = Date.now();
        
        return new Promise((resolve, reject) => {
            const checkInterval = setInterval(() => {
                const elapsedTime = Date.now() - startTime;
                
                // Verificar se AuthSystem est√° pronto
                if (window.authSystem && window.authSystem.supabase) {
                    clearInterval(checkInterval);
                    console.log(`‚úÖ AuthSystem pronto ap√≥s ${elapsedTime}ms`);
                    resolve();
                    return;
                }
                
                // Verificar timeout
                if (elapsedTime > maxWaitTime) {
                    clearInterval(checkInterval);
                    console.error('‚ùå TIMEOUT: AuthSystem n√£o inicializado ap√≥s 10 segundos');
                    reject(new Error('Timeout ao aguardar AuthSystem'));
                }
            }, 100);
        });
    }
</script>

<!-- ============================================ -->
<!-- FIM DO SNIPPET DE AUTENTICA√á√ÉO -->
<!-- ============================================ -->

<!-- IMPORTANTE: -->
<!-- 1. Todo o conte√∫do da p√°gina deve estar dentro de <div id="mainContent"> -->
<!-- 2. Exemplo: -->
<!--    <div id="mainContent"> -->
<!--        <h1>T√≠tulo da P√°gina</h1> -->
<!--        ... resto do conte√∫do ... -->
<!--    </div> -->
<!-- ============================================ -->



