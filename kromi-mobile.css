/**
 * ==========================================
 * KROMI MOBILE - Mobile-First Responsive Patterns
 * ==========================================
 * 
 * Mobile-first design with capability-based enhancements
 * Uses feature flags via body classes instead of device detection
 * 
 * Breakpoints:
 * xs: 0-360px
 * sm: 361-480px  
 * md: 481-768px
 * lg: 769-1024px
 * xl: 1025-1440px
 * xxl: 1441px+
 * 
 * Vers√£o: 2.0
 * ==========================================
 */

/* ==========================================
   ROOT: MOBILE SAFE AREAS
   ========================================== */

:root {
    /* Safe area insets for notches and system bars */
    --safe-area-inset-top: env(safe-area-inset-top, 0);
    --safe-area-inset-right: env(safe-area-inset-right, 0);
    --safe-area-inset-bottom: env(safe-area-inset-bottom, 0);
    --safe-area-inset-left: env(safe-area-inset-left, 0);
}

/* ==========================================
   BASE: TOUCH FRIENDLY TARGETS
   ========================================== */

@media (hover: none) and (pointer: coarse) {
    /* Ensure all interactive elements are touch-friendly */
    button,
    .btn,
    .nav-btn,
    .action-btn,
    .icon-btn {
        min-width: 44px;
        min-height: 44px;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
    }
    
    /* Prevent accidental zoom on double tap */
    button:active,
    .btn:active {
        transform: scale(0.95);
    }
    
    input,
    select,
    textarea,
    .form-input {
        min-height: 44px;
        font-size: clamp(16px, 4vw, 18px); /* Prevent zoom on iOS */
    }
}

/* ==========================================
   BASE: RESPONSIVE TYPOGRAPHY
   ========================================== */

body {
    font-size: clamp(14px, 4vw, 16px);
    line-height: clamp(1.4, 1.6, 1.8);
}

h1 { font-size: clamp(24px, 6vw, 32px); }
h2 { font-size: clamp(20px, 5vw, 24px); }
h3 { font-size: clamp(18px, 4.5vw, 20px); }
h4 { font-size: clamp(16px, 4vw, 18px); }

/* ==========================================
   BASE: VIEWPORT UNITS
   ========================================== */

/* Use svh/dvh for viewport height to handle dynamic browser chrome */
.camera-container {
    width: 100vw;
    height: 100dvh; /* Dynamic viewport height */
    position: fixed;
    top: 0;
    left: 0;
}

.layout-with-sidebar {
    min-height: 100dvh;
}

/* ==========================================
   XS BREAKPOINT (0-360px)
   ========================================== */

@media (max-width: 360px) {
    /* Ultra-compact layouts for small screens */
    .camera-info {
        top: calc(var(--safe-area-inset-top) + var(--spacing-2));
        left: var(--spacing-2);
        right: var(--spacing-2);
        flex-direction: column;
        gap: var(--spacing-1);
    }
    
    .detection-stats,
    .event-info {
        padding: clamp(4px, 1vw, 8px) clamp(6px, 2vw, 12px);
        font-size: clamp(9px, 3vw, 11px);
        max-width: 100%;
    }
    
    .side-controls .btn {
        min-width: 44px;
        height: 40px;
        padding: var(--spacing-1);
        font-size: clamp(10px, 3vw, 11px);
    }
    
    .main-camera-controls .btn {
        padding: clamp(8px, 2vw, 12px) clamp(12px, 3vw, 16px);
        font-size: clamp(12px, 3.5vw, 14px);
        min-width: clamp(100px, 30vw, 120px);
        height: clamp(44px, 12vw, 50px);
    }
}

/* ==========================================
   SM BREAKPOINT (361-480px)
   ========================================== */

@media (min-width: 361px) and (max-width: 480px) {
    .camera-info {
        top: calc(var(--safe-area-inset-top) + var(--spacing-3));
        left: var(--spacing-3);
        right: var(--spacing-3);
    }
    
    .side-controls {
        left: var(--spacing-2);
        gap: var(--spacing-1);
    }
    
    .main-camera-controls {
        bottom: calc(var(--safe-area-inset-bottom) + var(--spacing-3));
        gap: var(--spacing-2);
    }
}

/* ==========================================
   MD BREAKPOINT (481-768px)
   ========================================== */

@media (min-width: 481px) and (max-width: 768px) {
    .camera-info {
        top: calc(var(--safe-area-inset-top) + var(--spacing-4));
        left: var(--spacing-4);
        right: var(--spacing-4);
    }
    
    .side-controls {
        left: var(--spacing-3);
        gap: var(--spacing-2);
    }
    
    .main-camera-controls {
        bottom: calc(var(--safe-area-inset-bottom) + var(--spacing-4));
        gap: var(--spacing-3);
    }
}

/* ==========================================
   SMALL VIEWPORT HEIGHT (< 600px)
   ========================================== */

@media (max-height: 600px) {
    /* Landscape or very short screens */
    .main-camera-controls {
        flex-direction: column;
        align-items: center;
        bottom: clamp(4px, 1vh, 8px);
        gap: clamp(4px, 1vh, 8px);
    }
    
    .main-camera-controls .btn {
        width: clamp(70px, 15vw, 80px);
        margin-bottom: clamp(2px, 0.5vh, 4px);
    }
    
    .camera-info {
        flex-direction: row;
        gap: clamp(4px, 1vh, 8px);
    }
}

/* ==========================================
   CAPABILITY FLAGS: ASPECT RATIO
   ========================================== */

/* Tall screens (> 2.1) */
.ar-tall .camera-container {
    /* More vertical space for controls */
    padding-top: calc(var(--safe-area-inset-top) + var(--spacing-2));
}

/* Wide screens (< 1.7) */
.ar-wide .camera-controls {
    /* Horizontal layout optimization */
    flex-direction: row;
    justify-content: center;
}

/* ==========================================
   CAPABILITY FLAGS: ORIENTATION
   ========================================== */

/* Portrait orientation */
.portrait .main-camera-controls {
    bottom: calc(var(--safe-area-inset-bottom) + var(--spacing-4));
}

/* Landscape orientation */
.landscape .main-camera-controls {
    flex-direction: row;
    right: var(--spacing-4);
    left: auto;
    transform: none;
    width: auto;
    bottom: 50%;
    top: auto;
}

.landscape .side-controls {
    left: var(--spacing-2);
    right: auto;
    top: var(--spacing-2);
    flex-direction: row;
    transform: none;
}

/* ==========================================
   CAPABILITY FLAGS: STANDALONE PWA
   ========================================== */

.standalone .camera-container {
    /* PWA installed mode - full screen */
    height: 100vh;
}

.standalone .layout-with-sidebar {
    /* No browser chrome */
    min-height: 100vh;
}

/* ==========================================
   CAPABILITY FLAGS: NO TORCH
   ========================================== */

.no-torch #toggleFlash,
.no-torch .btn[data-flash] {
    display: none;
}

/* ==========================================
   CAPABILITY FLAGS: POINTER TYPE
   ========================================== */

/* Touch devices */
.pointer-coarse .btn {
    min-height: 44px;
    min-width: 44px;
}

.pointer-coarse .form-input {
    min-height: 44px;
    font-size: 16px; /* Prevent iOS zoom */
}

/* Mouse devices */
.pointer-fine .btn:hover {
    transform: translateY(-1px);
}

/* ==========================================
   LAYOUT: MOBILE LAYOUT WITH SIDEBAR
   ========================================== */

@media (max-width: 1024px) {
    /* Hide sidebar and header completely in mobile */
    .layout-with-sidebar .sidebar,
    .layout-with-sidebar .header {
        display: none !important;
    }
    
    /* Make main content fullscreen */
    .layout-with-sidebar .main {
        margin: 0 !important;
        width: 100% !important;
        height: 100dvh !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
    }
    
    /* Camera fullscreen */
    .camera-container {
        width: 100vw !important;
        height: 100dvh !important;
        position: fixed;
        top: 0;
        left: 0;
    }
    
    /* Show back button in mobile */
    .back-button-mobile {
        display: flex !important;
        position: fixed !important;
        top: calc(var(--safe-area-inset-top) + var(--spacing-2));
        left: var(--spacing-2);
        z-index: 30;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        border: 2px solid var(--primary);
        padding: var(--spacing-3);
        border-radius: var(--radius-full);
        width: clamp(40px, 10vw, 48px);
        height: clamp(40px, 10vw, 48px);
        align-items: center;
        justify-content: center;
        font-size: clamp(20px, 5vw, 24px);
        cursor: pointer;
        backdrop-filter: blur(10px);
        transition: all var(--transition-base);
        touch-action: manipulation;
    }
    
    /* Hide bottom nav in detection page */
    .app-bottom-nav {
        display: none !important;
    }
    
    /* Compact info display */
    .camera-info {
        top: calc(var(--safe-area-inset-top) + var(--spacing-4));
        left: var(--spacing-4);
        right: var(--spacing-4);
        flex-direction: column;
        gap: var(--spacing-2);
    }
    
    .side-controls {
        left: var(--spacing-2);
        top: 50%;
        gap: var(--spacing-1);
    }
    
    .side-controls .btn {
        padding: var(--spacing-2);
        font-size: clamp(10px, 3vw, 12px);
        min-width: 50px;
        height: 40px;
    }
    
    .main-camera-controls {
        bottom: calc(var(--safe-area-inset-bottom) + var(--spacing-4));
        gap: var(--spacing-2);
    }
    
    .main-camera-controls .btn {
        padding: clamp(10px, 2.5vw, 12px) clamp(14px, 3.5vw, 16px);
        font-size: clamp(13px, 3.5vw, 14px);
        min-width: clamp(110px, 30vw, 120px);
        height: clamp(44px, 12vw, 50px);
    }
    
    .detection-stats,
    .event-info {
        padding: clamp(4px, 1.5vw, 8px) clamp(6px, 2vw, 12px);
        font-size: clamp(10px, 3vw, 13px);
    }
}

/* ==========================================
   REDUCED MOTION SUPPORT
   ========================================== */

@media (prefers-reduced-motion: reduce) {
    .detection-area.active {
        animation: none;
    }
    
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* ==========================================
   REDUCED TRANSPARENCY SUPPORT
   ========================================== */

@media (prefers-reduced-transparency: reduce) {
    .detection-stats,
    .event-info,
    .back-button-mobile {
        backdrop-filter: none;
        background: rgba(0, 0, 0, 0.95);
    }
}

/* ==========================================
   ORIENTATION: PORTRAIT
   ========================================== */

@media (orientation: portrait) {
    .layout-with-sidebar .main {
        /* More vertical space available */
        padding: var(--spacing-3);
    }
}

/* ==========================================
   ORIENTATION: LANDSCAPE
   ========================================== */

@media (orientation: landscape) and (max-height: 600px) {
    /* Compact landscape on short screens */
    .camera-info {
        flex-direction: row;
        top: var(--spacing-2);
    }
    
    .main-camera-controls {
        flex-direction: row;
        bottom: var(--spacing-2);
    }
    
    .main-camera-controls .btn {
        min-width: clamp(80px, 12vw, 100px);
        padding: clamp(6px, 1.5vw, 8px) clamp(10px, 2vw, 12px);
    }
}

/* ==========================================
   CONTAINER QUERIES (Where Supported)
   ========================================== */

@container (max-width: 400px) {
    .camera-info {
        flex-direction: column;
    }
    
    .main-camera-controls {
        flex-direction: column;
        gap: var(--spacing-1);
    }
}

/* ==========================================
   HIGH CONTRAST MODE
   ========================================== */

@media (prefers-contrast: high) {
    .detection-area {
        border-width: 3px;
        border-style: solid;
    }
    
    .btn {
        border: 2px solid currentColor;
    }
}

/* ==========================================
   PRINT STYLES
   ========================================== */

@media print {
    .camera-container,
    .app-bottom-nav,
    .back-button-mobile {
        display: none !important;
    }
}

