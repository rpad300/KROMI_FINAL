<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Mobile - VisionKrono</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: white;
            margin: 0;
            padding: 20px;
        }
        
        .debug-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h2 {
            color: #00ff88;
        }
        
        .status {
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        
        button {
            padding: 10px 20px;
            margin: 10px 5px;
            border: none;
            border-radius: 5px;
            background: #00ff88;
            color: black;
            font-weight: bold;
            cursor: pointer;
        }
        
        #logs {
            background: #222;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üîç Debug Mobile Interface</h1>
    
    <div class="debug-info">
        <h2>üì± Device Info</h2>
        <div id="deviceInfo">Carregando...</div>
    </div>
    
    <div class="debug-info">
        <h2>üîß Configura√ß√µes</h2>
        <div id="configStatus">Verificando...</div>
        <button onclick="testConfigs()">Testar Configura√ß√µes</button>
        <button onclick="testSupabase()">Testar Supabase</button>
        <button onclick="testCamera()">Testar C√¢mera</button>
    </div>
    
    <div class="debug-info">
        <h2>üìã Logs</h2>
        <div id="logs"></div>
        <button onclick="clearLogs()">Limpar Logs</button>
    </div>
    
    <div class="debug-info">
        <h2>üéØ Links</h2>
        <a href="/detection" style="color: #00ff88;">P√°gina de Detec√ß√£o</a><br>
        <a href="/calibration" style="color: #00ff88;">P√°gina de Calibra√ß√£o</a><br>
        <a href="/" style="color: #00ff88;">P√°gina Principal</a>
    </div>
    
    <script src="/supabase.js"></script>
    <script>
        let logs = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            logs.push(logMessage);
            document.getElementById('logs').textContent = logs.join('\n');
            console.log(logMessage);
        }
        
        function clearLogs() {
            logs = [];
            document.getElementById('logs').textContent = '';
        }
        
        // Device info
        function showDeviceInfo() {
            const info = {
                userAgent: navigator.userAgent,
                screen: `${screen.width}x${screen.height}`,
                viewport: `${window.innerWidth}x${window.innerHeight}`,
                devicePixelRatio: window.devicePixelRatio,
                platform: navigator.platform,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine
            };
            
            document.getElementById('deviceInfo').innerHTML = Object.entries(info)
                .map(([key, value]) => `<strong>${key}:</strong> ${value}`)
                .join('<br>');
        }
        
        async function testConfigs() {
            log('üîß Testando configura√ß√µes...');
            
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                log('‚úÖ Servidor respondeu: ' + JSON.stringify(config, null, 2));
                
                // Testar localStorage
                const localArea = localStorage.getItem('visionkrono_number_area');
                const localCalibration = localStorage.getItem('visionkrono_calibration');
                
                log('üìÇ localStorage:');
                log('  - number_area: ' + (localArea ? 'EXISTE' : 'N√ÉO EXISTE'));
                log('  - calibration: ' + (localCalibration ? 'EXISTE' : 'N√ÉO EXISTE'));
                
                if (localArea) log('  - √Årea: ' + localArea);
                if (localCalibration) log('  - Calibra√ß√£o: ' + localCalibration);
                
            } catch (error) {
                log('‚ùå Erro: ' + error.message);
            }
        }
        
        async function testSupabase() {
            log('üìä Testando Supabase...');
            
            try {
                const client = new SupabaseClient();
                const connected = await client.init();
                
                log('üîó Supabase conectado: ' + (connected ? 'SIM' : 'N√ÉO'));
                
                if (connected) {
                    // Testar configura√ß√µes
                    const numberArea = await client.getConfiguration('number_area');
                    const calibration = await client.getConfiguration('calibration');
                    
                    log('üìè √Årea do Supabase: ' + (numberArea ? JSON.stringify(numberArea) : 'N√ÉO ENCONTRADA'));
                    log('üîß Calibra√ß√£o do Supabase: ' + (calibration ? JSON.stringify(calibration) : 'N√ÉO ENCONTRADA'));
                }
            } catch (error) {
                log('‚ùå Erro Supabase: ' + error.message);
            }
        }
        
        async function testCamera() {
            log('üìπ Testando c√¢mera...');
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                
                log('‚úÖ C√¢mera acess√≠vel');
                log('üìä Stream tracks: ' + stream.getTracks().length);
                
                // Parar stream
                stream.getTracks().forEach(track => track.stop());
                
            } catch (error) {
                log('‚ùå Erro c√¢mera: ' + error.message);
            }
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            showDeviceInfo();
            log('üöÄ Debug page carregada');
            
            // Testar automaticamente
            setTimeout(testConfigs, 1000);
            setTimeout(testSupabase, 2000);
        });
    </script>
</body>
</html>
