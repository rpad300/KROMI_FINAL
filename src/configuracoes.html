<!DOCTYPE html>
<html lang="pt" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√µes - VisionKrono</title>
    
    <link rel="stylesheet" href="/kromi-design-system.css">
    <link rel="stylesheet" href="/kromi-layout-fixes.css">
    <link rel="stylesheet" href="/dashboard-styles.css?v=2025102609">
    
    <!-- Sistema de Navega√ß√£o Unificado -->
    <link rel="stylesheet" href="/navigation-component.css?v=2025102601">
    <link rel="stylesheet" href="/unified-sidebar-styles.css?v=2025102601">
</head>
<body data-theme="dark" class="layout-with-sidebar">
    <!-- Sidebar (renderizada automaticamente pelo NavigationComponent) -->
    <div class="sidebar" id="sidebar"></div>
    
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <h1 class="header-title">‚öôÔ∏è Configura√ß√µes do Sistema</h1>
        </div>
        <div class="header-right">
            <!-- A√ß√µes do header se necess√°rio -->
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="main">
        <div id="mainContent" style="padding: var(--spacing-6);">
                <div class="section">
                    <h3>üîí Sess√µes</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Timeout de Inatividade</label>
                            <input type="number" value="45" readonly> minutos
                            <span class="helper-text">Tempo m√°ximo de inatividade antes de expirar sess√£o</span>
                        </div>
                        <div class="form-group">
                            <label>Vida M√°xima da Sess√£o</label>
                            <input type="number" value="12" readonly> horas
                            <span class="helper-text">Tempo m√°ximo absoluto de uma sess√£o</span>
                        </div>
                        <div class="form-group full-width">
                            <label>Sess√µes Ativas</label>
                            <div id="activeSessionsCount">Carregando...</div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>üõ°Ô∏è Seguran√ßa</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" checked disabled>
                                CSRF Protection Ativo
                            </label>
                            <span class="helper-text">Prote√ß√£o contra Cross-Site Request Forgery</span>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" checked disabled>
                                Cookies HttpOnly
                            </label>
                            <span class="helper-text">Prote√ß√£o contra XSS</span>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" checked disabled>
                                HTTPS Obrigat√≥rio
                            </label>
                            <span class="helper-text">Conex√µes seguras apenas</span>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" checked disabled>
                                Auditoria Ativa
                            </label>
                            <span class="helper-text">Todos os eventos s√£o registados</span>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>üìä Estat√≠sticas do Sistema</h3>
                    <div id="systemStats">Carregando...</div>
                </div>
                
                <div class="section">
                    <h3>üîë Configura√ß√µes de API</h3>
                    <p style="color: var(--text-secondary); margin-bottom: var(--spacing-4);">
                        Configure todas as chaves de API necess√°rias para o funcionamento da plataforma.
                    </p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Google Gemini API Key</label>
                            <div class="api-key-input">
                                <input type="password" id="geminiApiKey" placeholder="Digite sua chave da API Gemini">
                                <button type="button" class="api-key-toggle" onclick="togglePasswordVisibility('geminiApiKey')">üëÅÔ∏è</button>
                            </div>
                            <span class="helper-text">Chave para processamento com IA Gemini</span>
                        </div>
                        
                        <div class="form-group">
                            <label>Google Vision API Key</label>
                            <div class="api-key-input">
                                <input type="password" id="googleVisionApiKey" placeholder="Digite sua chave da API Google Vision">
                                <button type="button" class="api-key-toggle" onclick="togglePasswordVisibility('googleVisionApiKey')">üëÅÔ∏è</button>
                            </div>
                            <span class="helper-text">Chave para processamento com Google Vision</span>
                        </div>
                        
                        <div class="form-group full-width">
                            <label>Supabase URL</label>
                            <input type="text" id="supabaseUrl" placeholder="https://your-project.supabase.co">
                            <span class="helper-text">URL do seu projeto Supabase</span>
                        </div>
                        
                        <div class="form-group">
                            <label>Supabase Anon Key</label>
                            <div class="api-key-input">
                                <input type="password" id="supabaseAnonKey" placeholder="Digite sua chave an√¥nima do Supabase">
                                <button type="button" class="api-key-toggle" onclick="togglePasswordVisibility('supabaseAnonKey')">üëÅÔ∏è</button>
                            </div>
                            <span class="helper-text">Chave an√¥nima do Supabase</span>
                        </div>
                        
                        <div class="form-group">
                            <label>Supabase Service Role Key</label>
                            <div class="api-key-input">
                                <input type="password" id="supabaseServiceKey" placeholder="Digite sua chave de servi√ßo do Supabase">
                                <button type="button" class="api-key-toggle" onclick="togglePasswordVisibility('supabaseServiceKey')">üëÅÔ∏è</button>
                            </div>
                            <span class="helper-text">Chave de servi√ßo do Supabase (para opera√ß√µes administrativas)</span>
                        </div>
                        
                        <div class="form-group full-width">
                            <button class="btn btn-primary" onclick="saveApiConfigurations()">
                                üíæ Salvar Configura√ß√µes de API
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>üìß Configura√ß√µes de Email</h3>
                    <p style="color: var(--text-secondary); margin-bottom: var(--spacing-4);">
                        Configure o envio de emails para notifica√ß√µes e cria√ß√£o de utilizadores.
                    </p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Email do Sistema</label>
                            <input type="email" id="emailUser" placeholder="system@kromi.online">
                            <span class="helper-text">Email usado para enviar notifica√ß√µes</span>
                        </div>
                        
                        <div class="form-group">
                            <label>Password do Email</label>
                            <div class="api-key-input">
                                <input type="password" id="emailPassword" placeholder="Password do email">
                                <button type="button" class="api-key-toggle" onclick="togglePasswordVisibility('emailPassword')">üëÅÔ∏è</button>
                            </div>
                            <span class="helper-text">App Password do Gmail (recommendado)</span>
                        </div>
                        
                        <div class="form-group full-width">
                            <label>URL da Aplica√ß√£o</label>
                            <input type="text" id="appUrl" placeholder="https://kromi.online">
                            <span class="helper-text">URL usada nos emails (links de acesso)</span>
                        </div>
                        
                        <div class="form-group full-width">
                            <button class="btn btn-primary" onclick="saveEmailSettings()">
                                üíæ Salvar Configura√ß√µes de Email
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>ü§ñ Configura√ß√µes de Processador</h3>
                    <p style="color: var(--text-secondary); margin-bottom: var(--spacing-4);">
                        Configure o comportamento padr√£o dos processadores para toda a plataforma.
                    </p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Tipo de Processador Padr√£o</label>
                            <select id="defaultProcessorType">
                                <option value="gemini">ü§ñ Gemini AI</option>
                                <option value="google-vision">üëÅÔ∏è Google Vision</option>
                                <option value="ocr">üìÑ OCR Tradicional</option>
                                <option value="hybrid">üîÑ Sistema H√≠brido</option>
                                <option value="manual">‚úã Processamento Manual</option>
                            </select>
                            <span class="helper-text">Processador usado por padr√£o em novos eventos</span>
                        </div>
                        
                        <div class="form-group">
                            <label>Velocidade Padr√£o</label>
                            <select id="defaultProcessorSpeed">
                                <option value="fast">‚ö° R√°pido</option>
                                <option value="balanced">‚öñÔ∏è Equilibrado</option>
                                <option value="accurate">üéØ Preciso</option>
                            </select>
                            <span class="helper-text">Balanceamento entre velocidade e precis√£o</span>
                        </div>
                        
                        <div class="form-group full-width">
                            <label>Confian√ßa Padr√£o: <span id="defaultConfidenceValue">70%</span></label>
                            <input type="range" id="defaultProcessorConfidence" min="0.1" max="1.0" step="0.1" value="0.7">
                            <span class="helper-text">N√≠vel de confian√ßa m√≠nimo para aceitar detec√ß√µes autom√°ticas</span>
                        </div>
                        
                        <div class="form-group full-width">
                            <button class="btn btn-primary" onclick="saveProcessorSettings()">
                                üíæ Salvar Configura√ß√µes de Processador
                            </button>
                        </div>
                    </div>
                </div>
        </div>
    </main>
    
    <script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
    <script src="/supabase.js?v=2025102605" defer></script>
    <script src="/auth-client.js?v=2025102616" defer></script>
    <script src="/auth-helper.js?v=2025102620" defer></script>
    
    <!-- Sistema de Navega√ß√£o Unificado -->
    <script src="/navigation-config.js?v=2025102601" defer></script>
    <script src="/navigation-service.js?v=2025102601" defer></script>
    <script src="/navigation-component.js?v=2025102601" defer></script>
    <script src="/navigation-init.js?v=2025102601" defer></script>
    
    <!-- Prote√ß√£o de Rotas -->
    <script src="/universal-route-protection.js?v=2025102618" defer></script>
    
    <style>
        /* Estilos para API Key Inputs */
        .api-key-input {
            position: relative;
        }
        
        .api-key-input input {
            padding-right: 3rem;
        }
        
        .api-key-toggle {
            position: absolute;
            right: var(--spacing-3);
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: var(--font-size-lg);
            padding: var(--spacing-1);
        }
        
        .api-key-toggle:hover {
            color: var(--text-primary);
        }
        
        /* Se√ß√£o de configura√ß√µes */
        .section {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-5);
            border: 1px solid var(--border-color);
            margin-bottom: var(--spacing-5);
        }
        
        .section h3 {
            margin: 0 0 var(--spacing-4) 0;
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }
        
        .section p {
            margin-bottom: var(--spacing-4);
        }
        
        /* Range inputs */
        input[type="range"] {
            width: 100%;
            margin: var(--spacing-2) 0;
        }
        
        /* Bot√µes */
        .btn {
            padding: var(--spacing-3) var(--spacing-6);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            border: none;
            font-family: var(--font-family-base);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-primary-lg);
        }
        
        /* Form group improvements */
        .form-group input[type="text"],
        .form-group input[type="password"],
        .form-group select {
            padding: var(--spacing-3);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: var(--font-size-base);
            width: 100%;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(252, 107, 3, 0.1);
        }
    </style>
    
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const autenticado = await verificarAutenticacao(['admin']);
            if (!autenticado) return;
            
            loadSystemStats();
            loadApiConfigurations();
            loadEmailSettings();
            loadProcessorSettings();
        });
        
        async function loadSystemStats() {
            try {
                const response = await fetch('/api/auth/stats', {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const stats = data.stats;
                    
                    document.getElementById('activeSessionsCount').innerHTML = `
                        <div>Total: ${stats.total}</div>
                        <div>Ativas: ${stats.active}</div>
                        <div>Expiradas: ${stats.expired}</div>
                    `;
                    
                    document.getElementById('systemStats').innerHTML = `
                        <p>Timeout Inatividade: ${stats.inactivityTimeout} minutos</p>
                        <p>Vida M√°xima: ${stats.maxLifetime} horas</p>
                        <p>Sess√µes Totais: ${stats.total}</p>
                        <p>Sess√µes Ativas: ${stats.active}</p>
                    `;
                }
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
            }
        }
        
        function logout() {
            if (window.authSystem) {
                window.authSystem.signOut();
            }
        }
        
        // ==================== CONFIGURA√á√ïES DE API ====================
        
        async function loadApiConfigurations() {
            try {
                console.log('üì• Carregando configura√ß√µes de API...');
                
                // Garantir que o Supabase est√° inicializado
                if (window.supabaseClient) {
                    if (!window.supabaseClient.initialized) {
                        console.log('‚è≥ Inicializando Supabase...');
                        await window.supabaseClient.init();
                    }
                }
                
                if (!window.supabaseClient || !window.supabaseClient.supabase) {
                    console.log('‚ö†Ô∏è Supabase n√£o dispon√≠vel, usando configura√ß√µes padr√£o');
                    loadDefaultConfigurations();
                    return;
                }
                
                const { data, error } = await window.supabaseClient.supabase.rpc('get_platform_config', {
                    config_key_param: null
                });
                
                if (error) {
                    console.error('‚ùå Erro ao carregar configura√ß√µes:', error);
                    loadDefaultConfigurations();
                    return;
                }
                
                if (data && data.length > 0) {
                    data.forEach(config => {
                        const fieldMap = {
                            'GEMINI_API_KEY': 'geminiApiKey',
                            'GOOGLE_VISION_API_KEY': 'googleVisionApiKey',
                            'SUPABASE_URL': 'supabaseUrl',
                            'SUPABASE_ANON_KEY': 'supabaseAnonKey',
                            'SUPABASE_SERVICE_ROLE_KEY': 'supabaseServiceKey'
                        };
                        
                        const fieldId = fieldMap[config.config_key];
                        if (fieldId) {
                            const input = document.getElementById(fieldId);
                            if (input) {
                                input.value = config.config_value;
                            }
                        }
                    });
                    console.log('‚úÖ Configura√ß√µes de API carregadas da base de dados');
                } else {
                    console.log('‚ÑπÔ∏è Nenhuma configura√ß√£o encontrada na base de dados, usando valores padr√£o');
                    loadDefaultConfigurations();
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar configura√ß√µes de API:', error);
                loadDefaultConfigurations();
            }
        }
        
        function loadDefaultConfigurations() {
            const defaultConfigs = {
                'supabaseUrl': 'https://mdrvgbztadnluhrrnlob.supabase.co',
                'geminiApiKey': 'AIzaSyASJoaDUnVZLWQHavMWn7nmFR3qYbUdDQA',
                'googleVisionApiKey': 'AIzaSyBHR5jz1iVxlcoE8oDbbT3u6Y391FJ4Uds',
                'supabaseAnonKey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1kcnZnYnp0YWRubHVocnJubG9iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5OTQ1MDUsImV4cCI6MjA3NjU3MDUwNX0.x2po57tZOQ443NLVURBWDIYQnYbJ4D6O45FlZ5qwmp4',
                'supabaseServiceKey': 'sb_publishable_r5xSTAYcxfVh5zrvZPUafg_Dp-QgsTkG'
            };
            
            Object.entries(defaultConfigs).forEach(([fieldId, value]) => {
                const input = document.getElementById(fieldId);
                if (input && !input.value) {
                    input.value = value;
                }
            });
            
            console.log('‚úÖ Configura√ß√µes padr√£o carregadas');
        }
        
        async function saveApiConfigurations() {
            try {
                console.log('üíæ Salvando configura√ß√µes de API...');
                
                // Garantir que o Supabase est√° inicializado
                if (window.supabaseClient) {
                    if (!window.supabaseClient.initialized) {
                        console.log('‚è≥ Inicializando Supabase...');
                        await window.supabaseClient.init();
                    }
                }
                
                if (!window.supabaseClient || !window.supabaseClient.supabase) {
                    alert('‚ùå Supabase n√£o dispon√≠vel. N√£o foi poss√≠vel salvar as configura√ß√µes.');
                    return;
                }
                
                const apiConfigs = [
                    { key: 'GEMINI_API_KEY', value: document.getElementById('geminiApiKey').value },
                    { key: 'GOOGLE_VISION_API_KEY', value: document.getElementById('googleVisionApiKey').value },
                    { key: 'SUPABASE_URL', value: document.getElementById('supabaseUrl').value },
                    { key: 'SUPABASE_ANON_KEY', value: document.getElementById('supabaseAnonKey').value },
                    { key: 'SUPABASE_SERVICE_ROLE_KEY', value: document.getElementById('supabaseServiceKey').value }
                ];
                
                let savedCount = 0;
                for (const config of apiConfigs) {
                    if (config.value.trim()) {
                        const { error } = await window.supabaseClient.supabase.rpc('set_platform_config', {
                            config_key_param: config.key,
                            config_value_param: config.value,
                            config_type_param: 'api_key',
                            is_encrypted_param: true,
                            description_param: `Chave da API ${config.key}`
                        });
                        
                        if (error) {
                            console.error(`‚ùå Erro ao salvar ${config.key}:`, error);
                        } else {
                            savedCount++;
                        }
                    }
                }
                
                alert(`‚úÖ Configura√ß√µes salvas com sucesso! (${savedCount} configura√ß√µes)`);
                console.log('‚úÖ Configura√ß√µes de API salvas');
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar configura√ß√µes de API:', error);
                alert('‚ùå Erro ao salvar configura√ß√µes: ' + error.message);
            }
        }
        
        // ==================== CONFIGURA√á√ïES DE EMAIL ====================
        
        async function loadEmailSettings() {
            try {
                console.log('üì• Carregando configura√ß√µes de email...');
                
                // Garantir que o Supabase est√° inicializado
                if (window.supabaseClient) {
                    if (!window.supabaseClient.initialized) {
                        console.log('‚è≥ Inicializando Supabase...');
                        await window.supabaseClient.init();
                    }
                }
                
                if (!window.supabaseClient || !window.supabaseClient.supabase) {
                    console.log('‚ö†Ô∏è Supabase n√£o dispon√≠vel para configura√ß√µes de email');
                    return;
                }
                
                const { data, error } = await window.supabaseClient.supabase.rpc('get_platform_config', {
                    config_key_param: null
                });
                
                if (error) {
                    console.error('‚ùå Erro ao carregar configura√ß√µes de email:', error);
                    return;
                }
                
                if (data && data.length > 0) {
                    data.forEach(config => {
                        const fieldMap = {
                            'EMAIL_USER': 'emailUser',
                            'EMAIL_PASSWORD': 'emailPassword',
                            'APP_URL': 'appUrl'
                        };
                        
                        const fieldId = fieldMap[config.config_key];
                        if (fieldId) {
                            const input = document.getElementById(fieldId);
                            if (input) {
                                input.value = config.config_value;
                            }
                        }
                    });
                    console.log('‚úÖ Configura√ß√µes de email carregadas da base de dados');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar configura√ß√µes de email:', error);
            }
        }
        
        async function saveEmailSettings() {
            try {
                console.log('üíæ Salvando configura√ß√µes de email...');
                
                // Garantir que o Supabase est√° inicializado
                if (window.supabaseClient) {
                    if (!window.supabaseClient.initialized) {
                        console.log('‚è≥ Inicializando Supabase...');
                        await window.supabaseClient.init();
                    }
                }
                
                if (!window.supabaseClient || !window.supabaseClient.supabase) {
                    alert('‚ùå Supabase n√£o dispon√≠vel. N√£o foi poss√≠vel salvar as configura√ß√µes.');
                    return;
                }
                
                const emailConfigs = [
                    { key: 'EMAIL_USER', value: document.getElementById('emailUser').value },
                    { key: 'EMAIL_PASSWORD', value: document.getElementById('emailPassword').value },
                    { key: 'APP_URL', value: document.getElementById('appUrl').value }
                ];
                
                let savedCount = 0;
                for (const config of emailConfigs) {
                    if (config.value.trim()) {
                        const { error } = await window.supabaseClient.supabase.rpc('set_platform_config', {
                            config_key_param: config.key,
                            config_value_param: config.value,
                            config_type_param: 'email',
                            is_encrypted_param: true,
                            description_param: `Configura√ß√£o de email: ${config.key}`
                        });
                        
                        if (error) {
                            console.error(`‚ùå Erro ao salvar ${config.key}:`, error);
                        } else {
                            savedCount++;
                        }
                    }
                }
                
                alert(`‚úÖ Configura√ß√µes de email salvas com sucesso! (${savedCount} configura√ß√µes)`);
                console.log('‚úÖ Configura√ß√µes de email salvas');
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar configura√ß√µes de email:', error);
                alert('‚ùå Erro ao salvar configura√ß√µes: ' + error.message);
            }
        }
        
        // ==================== CONFIGURA√á√ïES DE PROCESSADOR ====================
        
        async function loadProcessorSettings() {
            try {
                console.log('üì• Carregando configura√ß√µes de processador...');
                
                // Garantir que o Supabase est√° inicializado
                if (window.supabaseClient) {
                    if (!window.supabaseClient.initialized) {
                        console.log('‚è≥ Inicializando Supabase...');
                        await window.supabaseClient.init();
                    }
                }
                
                if (!window.supabaseClient || !window.supabaseClient.supabase) {
                    console.log('‚ö†Ô∏è Supabase n√£o dispon√≠vel para configura√ß√µes de processador');
                    return;
                }
                
                const { data, error } = await window.supabaseClient.supabase.rpc('get_global_processor_setting', {
                    setting_key_param: null
                });
                
                if (error) {
                    console.error('‚ùå Erro ao carregar configura√ß√µes de processador:', error);
                    return;
                }
                
                if (data && data.length > 0) {
                    data.forEach(setting => {
                        switch (setting.setting_key) {
                            case 'default_processor_type':
                                const typeSelect = document.getElementById('defaultProcessorType');
                                if (typeSelect) typeSelect.value = setting.setting_value;
                                break;
                            case 'default_processor_speed':
                                const speedSelect = document.getElementById('defaultProcessorSpeed');
                                if (speedSelect) speedSelect.value = setting.setting_value;
                                break;
                            case 'default_processor_confidence':
                                const confidenceRange = document.getElementById('defaultProcessorConfidence');
                                const confidenceValue = document.getElementById('defaultConfidenceValue');
                                if (confidenceRange) {
                                    confidenceRange.value = setting.setting_value;
                                    if (confidenceValue) {
                                        confidenceValue.textContent = Math.round(parseFloat(setting.setting_value) * 100) + '%';
                                    }
                                }
                                break;
                        }
                    });
                }
                
                // Adicionar listener para range de confian√ßa
                const confidenceRange = document.getElementById('defaultProcessorConfidence');
                const confidenceValue = document.getElementById('defaultConfidenceValue');
                
                if (confidenceRange && confidenceValue) {
                    confidenceRange.addEventListener('input', function() {
                        confidenceValue.textContent = Math.round(this.value * 100) + '%';
                    });
                }
                
                console.log('‚úÖ Configura√ß√µes de processador carregadas');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar configura√ß√µes de processador:', error);
            }
        }
        
        async function saveProcessorSettings() {
            try {
                console.log('üíæ Salvando configura√ß√µes de processador...');
                
                // Garantir que o Supabase est√° inicializado
                if (window.supabaseClient) {
                    if (!window.supabaseClient.initialized) {
                        console.log('‚è≥ Inicializando Supabase...');
                        await window.supabaseClient.init();
                    }
                }
                
                if (!window.supabaseClient || !window.supabaseClient.supabase) {
                    alert('‚ùå Supabase n√£o dispon√≠vel. N√£o foi poss√≠vel salvar as configura√ß√µes.');
                    return;
                }
                
                const settings = [
                    { key: 'default_processor_type', value: document.getElementById('defaultProcessorType').value },
                    { key: 'default_processor_speed', value: document.getElementById('defaultProcessorSpeed').value },
                    { key: 'default_processor_confidence', value: document.getElementById('defaultProcessorConfidence').value }
                ];
                
                let savedCount = 0;
                for (const setting of settings) {
                    const { error } = await window.supabaseClient.supabase.rpc('set_global_processor_setting', {
                        setting_key_param: setting.key,
                        setting_value_param: setting.value,
                        description_param: `Configura√ß√£o: ${setting.key}`
                    });
                    
                    if (error) {
                        console.error(`‚ùå Erro ao salvar ${setting.key}:`, error);
                    } else {
                        savedCount++;
                    }
                }
                
                alert(`‚úÖ Configura√ß√µes de processador salvas com sucesso! (${savedCount} configura√ß√µes)`);
                console.log('‚úÖ Configura√ß√µes de processador salvas');
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar configura√ß√µes de processador:', error);
                alert('‚ùå Erro ao salvar configura√ß√µes: ' + error.message);
            }
        }
        
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üôà';
            } else {
                input.type = 'password';
                button.textContent = 'üëÅÔ∏è';
            }
        }
    </script>
</body>
</html>

